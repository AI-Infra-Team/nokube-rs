{
	"nodes":[
		{"id":"2646f8feb06d5f3b","type":"group","x":-160,"y":360,"width":2820,"height":3400,"label":"é›†ç¾¤ä¾§"},
		{"id":"7c01f0b4dd6ebad7","type":"group","x":380,"y":390,"width":2260,"height":3330,"label":"general"},
		{"id":"1992741a2aa2fe3b","type":"group","x":-80,"y":-650,"width":2809,"height":910,"label":"æ§åˆ¶ä¾§"},
		{"id":"38790d011e928eb9","type":"group","x":440,"y":2560,"width":2170,"height":1120,"label":"exporter"},
		{"id":"0520f5a5ed0e5699","type":"group","x":2700,"y":260,"width":1380,"height":1465,"label":"ç›‘æ§é¢æ¿"},
		{"id":"029a051cde4f5915","type":"group","x":-1280,"y":260,"width":820,"height":1630,"label":"é›†ç¾¤é™æ€é…ç½®+é›†ç¾¤actoråŠ¨æ€é…ç½®"},
		{"id":"689775cc9b14b219","type":"group","x":1880,"y":-597,"width":780,"height":805,"label":"k8såŸç”Ÿå‘½ä»¤"},
		{"id":"30cdd7fa9b891781","type":"group","x":-140,"y":390,"width":520,"height":850,"label":"service agent"},
		{"id":"9cf48181aa1561ab","type":"group","x":500,"y":-565,"width":880,"height":402,"label":"new-or-update"},
		{"id":"b1d202983b97c1eb","type":"group","x":660,"y":-960,"width":700,"height":280,"label":"ç¤ºä¾‹"},
		{"id":"8c4790e1a4bce75f","type":"group","x":459,"y":520,"width":346,"height":460,"label":"k8s"},
		{"id":"771931171fc21987","type":"group","x":-5,"y":1380,"width":385,"height":260,"label":"master"},
		{"id":"etcd-storage","type":"text","text":"## etcd åˆ†å¸ƒå¼å­˜å‚¨\n\n### æ•°æ®ç»“æ„:\n**ä¸šåŠ¡æ•°æ®:**\n- `/nokube/{cluster}/pods/{name}` - PodçŠ¶æ€\n- `/nokube/{cluster}/events/pod/{name}` - Podäº‹ä»¶\n- `/nokube/{cluster}/deployments/{name}` - Deploymenté…ç½®\n- `/nokube/{cluster}/daemonsets/{name}` - DaemonSeté…ç½®\n- `/nokube/{cluster}/configmaps/{name}` - ConfigMap\n- `/nokube/{cluster}/secrets/{name}` - Secret\n- `cluster/{name}` - é›†ç¾¤å…ƒæ•°æ®\n- `k8s/configmap/{ns}/{name}` - K8s ConfigMap\n- `k8s/secret/{ns}/{name}` - K8s Secret\n\n**Actorå­˜æ´»ç›‘æ§:**\n- `/nokube/{cluster}/actors/{actor-path}/alive` - Actorå­˜æ´»çŠ¶æ€\n  - åŒ…å«lease_ttlã€last_aliveæ—¶é—´æˆ³\n  - the_proxyå®šæœŸæ›´æ–°\n  - è¶…æ—¶æ ‡è®°ä¸ºDead\n\n### å†™å…¥è€…:\n- ConfigManager (é›†ç¾¤é…ç½®)\n- ServiceAgent (PodçŠ¶æ€/äº‹ä»¶)\n- K8sStorage (K8sèµ„æº)\n- **TheProxy (Actorå­˜æ´»çŠ¶æ€)**\n\n### è¯»å–è€…:\n- ServiceAgent (éƒ¨ç½²é…ç½®)\n- Exporter (é›†ç¾¤é…ç½®)\n- CLI (PodçŠ¶æ€æŸ¥è¯¢)\n- **TheProxy (Actorå­˜æ´»ç›‘æ§)**","x":-1260,"y":280,"width":680,"height":760},
		{"id":"cluster-config","type":"text","text":"## é›†ç¾¤é…ç½®æ–‡ä»¶\n\n**cluster-config.yaml**\n\n```yaml\ncluster_name: home-cluster\n\nnodes:\n  - ssh_url: \"10.126.126.234:2222\"\n    name: \"pinghu-container\"\n    role: \"head\"\n    workspace: \"/opt/devcon/pa/nokube-workspace\"\n    storage:\n      type: \"local\"\n      path: \"/data/ray/head\"\n    users:\n      - userid: \"pa\"\n        password: \"74123\"\n```\n\nğŸ”§ **Workspaceé…ç½®æ¥æº:**\n1. **é›†ç¾¤é…ç½®æ–‡ä»¶** - æ¯ä¸ªèŠ‚ç‚¹çš„workspaceå­—æ®µ\n2. **ä»£ç ç¡¬ç¼–ç ** - ServiceAgentä¸­çš„é»˜è®¤è·¯å¾„\n3. **åŠ¨æ€ä¼ é€’** - é€šè¿‡ClusterConfigä¼ é€’ç»™Dockeræ“ä½œæ¨¡å—\n\nğŸ“‚ **å®é™…è·¯å¾„æ„å»º:**\n- åŸºç¡€è·¯å¾„: `{node.workspace}`\n- ConfigMapè·¯å¾„: `{workspace}/configmaps/{deployment-name}`\n- å­˜å‚¨è·¯å¾„: `{workspace}/{storage.path}`","x":-1200,"y":1130,"width":720,"height":740},
		{"id":"config-module","type":"text","text":"## Config æ¨¡å—\n\n**src/config/**\n- etcd_manager.rs\n- config_manager.rs\n\nğŸ”§ é›†ç¾¤é…ç½®å­˜å‚¨\nğŸ“Š èŠ‚ç‚¹é…ç½®ç®¡ç†","x":-755,"y":-175,"width":260,"height":275},
		{"id":"nokube-config","type":"text","text":"## Nokube å…¨å±€é…ç½®\n\nè·¯å¾„\n- ç”¨æˆ·çº§: `~/.nokube/config.yaml` (ä¼˜å…ˆ)\n- å…¨å±€çº§: `/etc/.nokube/config.yaml`\n- Agent å®¹å™¨è¯»å–: `/etc/.nokube/config.yaml`ï¼ˆéƒ¨ç½²æ—¶å°† `{workspace}/config/config.yaml` æŒ‚è½½ï¼‰\n\næ ¼å¼ (YAML)\n```yaml\netcd_endpoints:\n  - 'http://10.0.0.10:2379'\n  - 'http://10.0.0.11:2379'\n```\nâš ï¸ ç«¯ç‚¹å¿…é¡»åŒ…å« `http://` æˆ– `https://` å‰ç¼€\n\nè¯»å–ä¼˜å…ˆçº§\n1. ç”¨æˆ·çº§ `~/.nokube/config.yaml`\n2. å…¨å±€çº§ `/etc/.nokube/config.yaml`\n\né…ç½®æ–¹æ³•\n- æœ¬æœºåˆ›å»ºä¸Šè¿°æ–‡ä»¶å¹¶å¡«å…¥ `etcd_endpoints`\n- éƒ¨ç½²æ—¶ï¼Œæ§åˆ¶å™¨ä¸Šä¼ åˆ°æ¯èŠ‚ç‚¹ `{workspace}/config/config.yaml`\n- å¯åŠ¨ Agent æ—¶ç»‘å®šä¸ºå®¹å™¨å†… `/etc/.nokube/config.yaml`\n\néƒ¨ç½²åˆ†å¸ƒ\n- æœ¬åœ° CLI/æ§åˆ¶å™¨: è¯»å–æœ¬æœºé…ç½®\n- è¿œç¨‹èŠ‚ç‚¹: `{workspace}/config/config.yaml` â†’ å®¹å™¨ `/etc/.nokube/config.yaml`ï¼ˆä¾› Agent/TheProxy è®¿é—® etcdï¼‰\n- ç›¸å…³ etcd å­˜å‚¨é”®ï¼š\n  - ClusterMeta: `cluster/{name}`\n  - ClusterConfig: `{cluster_name}`\n  - K8s å¯¹è±¡: `/nokube/{cluster}/(configmaps|secrets|deployments|daemonsets|pods|events/pod)`","x":-1400,"y":-880,"width":560,"height":980},
		{"id":"n-nokube-artifacts","type":"text","text":"## Nokube æ‰“åŒ… (HTTP åˆ†å‘)\n- äº§ç‰©ç›®å½• (Head èŠ‚ç‚¹): `<workspace>/<mount_subpath>/releases/nokube`\n  - `bin/nokube`\n  - `lib/libcrypto.so.1.1`, `lib/libssl.so.1.1` (å¯é€‰)\n  - `nokube-image.tar` (å¯é€‰: é¢„æ„å»ºé•œåƒ)\n  - `manifest.json`, `install.sh`\n- ç”Ÿæˆæ—¶æœº: CLI `new-or-update` é˜¶æ®µ\n- è¯´æ˜: GitOps Canvas ä¸­ HTTP Server èŠ‚ç‚¹äº¦æœ‰æ ‡æ³¨","x":-720,"y":-750,"width":520,"height":360},
		{"id":"dashboard-actor","type":"text","text":"## Dashboard: Actor\n\nç”¨é€”\n- è¿è¡Œå½’å±è§†è§’ï¼šæŒ‰ root_actor åˆ†ç»„æŸ¥çœ‹ pod/container æ˜ç»†ä¸æ—¶åº\n- åŒæ—¶åŒ…å« K8s æ¦‚è§ˆï¼ˆåˆå¹¶åŸ Service è§†å›¾ï¼‰\n\nå˜é‡\n- cluster: `label_values(nokube_container_cpu_cores, cluster_name)`\n- root_actor: `label_values(..., root_actor)`\n- cpu_axis_max, mem_axis_max: è‡ªåŠ¨æ¢æµ‹ä¸Šé™\n\né¢æ¿å¸ƒå±€\n- å…¨å±€æ€»è§ˆï¼ˆåˆå¹¶è‡ª Serviceï¼‰:\n  - K8s Objects Overview (Namespace/Object/Name/Status/Parent)\n  - Podâ€“DaemonSet Relationship (status 1/0, stepped)\n  - Container CPU/Memory (%) (stacked)\n  - Service Events Timeline (increase(...[5m]))\n- Root Actors (stat)\n- Container Count ($cluster) (stat)\n- æŒ‰ $root_actor é‡å¤åˆ†ç»„: \n  - Pods of $root_actor (è¡¨: node/pod)\n  - Containers of $root_actor (è¡¨: node/pod/container)\n  - Container CPU (cores) [$root_actor] (timeseries)\n  - Container Memory (bytes) [$root_actor] (timeseries)\n\nè¯´æ˜\n- æ•°æ®æº: `GreptimeDB`","x":3480,"y":335,"width":540,"height":830},
		{"id":"dash-cluster-home","type":"text","text":"## ç›‘æ§é¢æ¿è§„åˆ’\n- Cluster Dashboard è®¾ç½®ä¸ºé»˜è®¤é¦–é¡µ\n- é¡¶éƒ¨æ–°å¢ â€˜å…³é”®é“¾æ¥â€™ é¢æ¿ï¼Œæä¾›å¿«æ·è·³è½¬ï¼š\n  - Actor Dashboard (/d/nokube-actor-dashboard)\n  - Logs (MySQL) (/d/nokube-logs-mysql)\n  - HTTP æ–‡ä»¶æœåŠ¡å™¨ (Head èŠ‚ç‚¹)\n  - Greptime Metrics (/v1/prometheus)","x":2750,"y":300,"width":580,"height":300},
		{"id":"dash-links-panel","type":"text","text":"### å…³é”®é“¾æ¥é¢æ¿ï¼ˆCluster ä»ªè¡¨ç›˜å†…ï¼‰\nä½¿ç”¨ Text é¢æ¿ (markdown) å®ç°ï¼š\n- [Actor Dashboard](/d/nokube-actor-dashboard)\n- [Logs (MySQL)](/d/nokube-logs-mysql)\n- [HTTP æ–‡ä»¶æœåŠ¡å™¨](http://<head>:<http_port>)\n- [Greptime Metrics](http://<head>:<greptime_port>/v1/prometheus)","x":2750,"y":640,"width":580,"height":280},
		{"id":"docker-ops-module","type":"text","text":"## ğŸ³ Docker æ“ä½œæ¨¡å—\n\n**src/agent/general/docker_runner.rs**\n\n### æ ¸å¿ƒåŠŸèƒ½:\nğŸ—ï¸ **å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**\n- åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤\n- å¥åº·æ£€æŸ¥å’Œç›‘æ§\n- é”™è¯¯å¤„ç†å’Œæ¢å¤\n\nğŸ—‚ï¸ **å·æŒ‚è½½ç®¡ç†**\n- ConfigMap æ–‡ä»¶æŒ‚è½½\n- Secret å®‰å…¨æŒ‚è½½\n- å·¥ä½œç©ºé—´ç›®å½•ç»‘å®š\n- æƒé™å’Œå®‰å…¨æ§åˆ¶\n\nğŸŒ **ç½‘ç»œå’Œç«¯å£**\n- ç«¯å£æ˜ å°„å’Œè½¬å‘\n- ç½‘ç»œæ¨¡å¼é…ç½®\n- å®¹å™¨é—´é€šä¿¡\n\nâš™ï¸ **GitOps ConfigMap å¤„ç†**\n```rust\n// 1. è§£æYAMLå†…åµŒé…ç½®\nlet configmap_data = spec.get(\"configMap\")\n  .and_then(|cm| cm.get(\"data\"));\n\n// 2. åˆ›å»ºä¸»æœºæ–‡ä»¶ç³»ç»Ÿ\nlet config_dir = format!(\n  \"{}/configmaps/{}\", \n  workspace, deployment_name\n);\n\n// 3. å†™å…¥é…ç½®æ–‡ä»¶\nfor (filename, content) in configmap_data {\n  let file_path = format!(\n    \"{}/{}\", config_dir, filename\n  );\n  std::fs::write(&file_path, content)?;\n}\n\n// 4. æŒ‚è½½åˆ°å®¹å™¨\nconfig = config.add_volume(\n  config_dir, \n  \"/etc/config\".to_string(), \n  true // read-only\n);\n```\n\nğŸ”’ **å®‰å…¨ç‰¹æ€§**\n- è¾“å…¥éªŒè¯å’Œæ¸…ç†\n- å‘½ä»¤æ³¨å…¥é˜²æŠ¤\n- æƒé™éš”ç¦»\n- èµ„æºé™åˆ¶","x":1060,"y":430,"width":520,"height":970},
		{"id":"docker-config-example","type":"text","text":"## ConfigMap æŒ‚è½½ç¤ºä¾‹\n\n**GitOps YAMLç»“æ„:**\n```yaml\nspec:\n  configMap:\n    data:\n      requirements.txt: \"flask==2.3.2\\nrequests==2.31.0\"\n      webhook-server.py: \"#!/usr/bin/env python3\\n...\"\n  webhookDeployment:\n    containerSpec:\n      image: python:3.10-slim\n      command: [\"/bin/bash\"]\n      args: [\n        \"-c\", \n        \"pip install -r /etc/config/requirements.txt && python /etc/config/webhook-server.py\"\n      ]\n```\n\n**ç”Ÿæˆçš„Dockerå‘½ä»¤:**\n```bash\ndocker run -d \\\n  --name nokube-pod-{deployment-name} \\\n  -v {workspace}:/pod-workspace \\\n  -v {workspace}/configmaps/{deployment-name}:/etc/config:ro \\\n  -e FLASK_PORT=8080 \\\n  python:3.10-slim \\\n  /bin/bash -c \"pip install -r /etc/config/requirements.txt && python /etc/config/webhook-server.py\"\n```\n\n**æ–‡ä»¶ç³»ç»Ÿç»“æ„:**\n```\n{workspace}/\nâ”œâ”€â”€ configmaps/\nâ”‚   â””â”€â”€ {deployment-name}/\nâ”‚       â”œâ”€â”€ requirements.txt\nâ”‚       â””â”€â”€ webhook-server.py\nâ””â”€â”€ ...\n```\n\n**åŠ¨æ€å˜é‡è¯´æ˜:**\n- `{workspace}` - å·¥ä½œç©ºé—´è·¯å¾„ (é»˜è®¤: /opt/devcon/pa/nokube-workspace)\n- `{deployment-name}` - éƒ¨ç½²åç§° (å¦‚: gitops-webhook-server-home-cluster)\n- `{cluster-name}` - é›†ç¾¤åç§°","x":1590,"y":440,"width":940,"height":880},
		{"id":"63a7919ba26e1c77","type":"text","text":"the_proxy\nç‰¹æ®Šactoråç¨‹ï¼Œä¸€ä¸ªagentä¸€ä¸ªï¼Œç”¨äºèšåˆæ‰€æœ‰ k8s actor ä¸€æ®µæ—¶é—´å†…çš„è¯·æ±‚ï¼ˆä¸€èˆ¬å°±æ˜¯æ ¡éªŒå…¶ä»å±ä»¥åŠç®¡æ§çš„actoræ˜¯å¦aliveï¼‰\n\nä»¥åŠkeepalive","x":480,"y":545,"width":300,"height":195},
		{"id":"9213010bd51b4eba","type":"text","text":"dockerå¯åŠ¨ï¼Œç¨³å®šéš”ç¦»è¿è¡Œ","x":-100,"y":430,"width":160,"height":90},
		{"id":"dashboard-cluster","type":"text","text":"## Dashboard: Cluster\n\né¢æ¿å¸ƒå±€\n- Cluster Memory Usage (%)\n- Cluster Container Memory (bytes, stacked) + Used/Total å åŠ \n- Network RX/TX (Bytes/s)\n- Cluster Container CPU (%) (stacked)\n- Node Memory Used vs Total (bytes)\n\nè¯´æ˜\n- æ•°æ®æº: `GreptimeDB`\n- æ—¶é—´: now-1h, åˆ·æ–°: 30s\n- ä¸»è¦ç»´åº¦: instance/node, container","x":2720,"y":335,"width":597,"height":430},
		{"id":"dashboard-logs","type":"text","text":"## Dashboard: Logs (MySQL)\n\nå˜é‡\n- container_path: SELECT DISTINCT scope_name AS text FROM opentelemetry_logs WHERE scope_name <> '' ORDER BY text\n\né¢æ¿å¸ƒå±€\n- Log Messages (Latest):\n\t```\n\tSELECT timestamp AS time, body AS message, severity_text AS level  FROM opentelemetry_logs  WHERE $__timeFilter(timestamp) AND (${container_path:sqlstring} = '' OR scope_name = ${container_path:sqlstring})  ORDER BY timestamp DESC LIMIT 1000\n\t```\n- Log Level Distribution: æŒ‰ severity_text è®¡æ•° (åŒæ ·ä½¿ç”¨ container_path å¯é€‰ç­›é€‰)\n- Logs per Minute: $__timeGroup(timestamp,'1m') + å¯é€‰ container_path ç­›é€‰\n\nè¯´æ˜\n- æ•°æ®æº: `greptimemysql` (Greptime MySQL)\n- æ—¥å¿—é¢æ¿å•è¡Œå±•ç¤ºï¼šéšè—æ ‡ç­¾ã€ç¦ç”¨æŠ˜å \n- ä½¿ç”¨ scope_name ä¿å­˜å®¹å™¨ Full Path (cluster/root_actor/pod/container)ï¼Œç”¨äºç²¾ç¡®ç­›é€‰","x":2729,"y":805,"width":731,"height":575},
		{"id":"21029617ed1cf87d","type":"text","text":"","x":2720,"y":280,"width":250,"height":4},
		{"id":"remote-control","type":"text","text":"## Remote Control\n\n**src/remote_ctl/**\n- ssh_manager.rs\n- deployment_controller.rs\n\nğŸ”— SSH è¿æ¥ç®¡ç†\nğŸš€ åˆ†å¸ƒå¼éƒ¨ç½²\n\n### ğŸ³ Dockeré•œåƒæ„å»ºä¸åˆ†å‘\n**prepare_dependencies()æ–°å¢åŠŸèƒ½:**\n1. æ„å»ºåŒ…å«Dockerçš„nokubeé•œåƒ\n   ```dockerfile\n   FROM ubuntu:22.04\n   RUN apt-get install docker.io python3-pip\n   COPY target/nokube /usr/local/bin/nokube\n   ```\n2. å¯¼å‡ºé•œåƒä¸ºtaråŒ…: `docker save -o nokube-image.tar`\n3. SSHä¸Šä¼ taråŒ…åˆ°å„èŠ‚ç‚¹\n4. è¿œç¨‹åŠ è½½é•œåƒ: `docker load -i nokube-image.tar`\n\n**ä¼˜åŠ¿:**\nâœ… é¿å…æ¯æ¬¡å®¹å™¨å¯åŠ¨é‡æ–°ä¸‹è½½\nâœ… é•œåƒä¸€æ¬¡æ„å»ºï¼Œå¤šèŠ‚ç‚¹å¤ç”¨\nâœ… ç¦»çº¿ç¯å¢ƒæ”¯æŒ\nâœ… ç½‘ç»œå¸¦å®½èŠ‚çœ\n\n### ğŸ“‚ æ–‡ä»¶ä¸Šä¼ æ¥å£ä¿éšœ\n- è‡ªåŠ¨åˆ›å»ºè¿œç¨‹çˆ¶ç›®å½•: `mkdir -p <parent>`\n- è‡ªåŠ¨è®¾ç½®ç›®å½•å½’å±ä¸ºå½“å‰SSHç”¨æˆ·: `chown -R {user}:{user} <dir>`\n- å•æ–‡ä»¶ä¸Šä¼ : `upload_file` / `force_upload_file`\n- ç›®å½•ä¸Šä¼ : `upload_directory` (é€’å½’å¤„ç†å¹¶ç»Ÿä¸€æƒé™)\n- è°ƒç”¨æ–¹æ— éœ€é¢å¤– mkdir/chownï¼Œæ¥å£å·²å†…å»º","x":-29,"y":-630,"width":510,"height":860},
		{"id":"cli-new-or-update","type":"text","text":"## CLI: new-or-update\n\nç”¨æ³•\n- `nokube new-or-update [config.yaml]`\n\nè¯´æ˜\n- æœªæä¾›æ–‡ä»¶æ—¶ç”Ÿæˆæ¨¡æ¿ `cluster-config-template.yaml` å¹¶æç¤ºäºŒæ¬¡æ‰§è¡Œ\n- æŒä¹…åŒ–é›†ç¾¤é…ç½®åˆ° etcd å¹¶è§¦å‘éƒ¨ç½²/æ›´æ–°\n\nç¤ºä¾‹\n- `nokube new-or-update ./home-cluster.yaml`","x":520,"y":-545,"width":360,"height":362},
		{"id":"k8s-abstraction","type":"text","text":"## K8s æ¨¡æ‹Ÿå±‚\nk8sä¸­çš„daemonsetã€deploymentã€pod ç»Ÿä¸€ç§°ä½œactorï¼Œä¸ºæŸä¸ªagenté‡Œçš„ä¸€ä¸ªåç¨‹æ‰€ç®¡æ§\n\n**src/k8s/**\n- objects.rs\n- controllers.rs\n- storage.rs\n- heartbeat.rs\n\nğŸ“¦ Pod ç®¡ç†\nâš–ï¸ DaemonSet/Deployment\nğŸ” Config/Secret å­˜å‚¨\nğŸ’“ ç”Ÿå‘½å‘¨æœŸç›‘æ§","x":-30,"y":790,"width":370,"height":430},
		{"id":"d8d98b5f9f5121be","type":"text","text":"k8s actor \nå¯¹åº”etcd æŸä¸ªé…ç½®\næ­¤å¤–è¿™ä¸ªactorçš„aliveåº”è¯¥å†—ä½™ä¸€ä¸ªkeyï¼Œå¹¶ä¸”æŒ‰ç…§è¿™ä¸ªactorçš„ç²’åº¦è®¾ç½®lease\nå®šæœŸå‘ the proxyå‘å‡ºè¯·æ±‚ï¼Œä¿æ´»è‡ªå·±çš„leaseä»¥åŠæ£€æŸ¥è‡ªå·±å…³è”ç»„ä»¶","x":480,"y":760,"width":300,"height":195},
		{"id":"agent-system","type":"text","text":"## Agent ç³»ç»Ÿ\n\n**src/agent/**\n- general/ é€šç”¨åŠŸèƒ½\n- master_agent/ ä¸»ä»£ç†\n- service_agent/ æœåŠ¡ä»£ç†\n\nğŸ¤– è¿œç¨‹å‘½ä»¤æ‰§è¡Œ\nğŸ“ˆ ç›‘æ§æ•°æ®æ”¶é›†\nğŸ³ å®¹å™¨ç®¡ç†","x":-400,"y":-50,"width":300,"height":300},
		{"id":"cli-monitor","type":"text","text":"## CLI: monitor\n\nç”¨æ³•\n- `nokube monitor --cluster <name>`\n\nè¯´æ˜\n- å¯åŠ¨ GreptimeDB + Grafanaï¼Œè‡ªåŠ¨é…ç½®æ•°æ®æºä¸ä»ªè¡¨ç›˜\n\nç¤ºä¾‹\n- `nokube monitor --cluster home-cluster`","x":520,"y":-142,"width":360,"height":362},
		{"id":"gitops-extension","type":"text","text":"## GitOps æ‰©å±•\n\n**examples/gitops/**\n- è‡ªåŠ¨åŒ–éƒ¨ç½²\n- é…ç½®åŒæ­¥\n\nğŸ”§ **ConfigMap æŒ‚è½½æ”¯æŒ**\n- YAMLå†…åµŒé…ç½®æ–‡ä»¶\n- è‡ªåŠ¨æ–‡ä»¶ç³»ç»Ÿæ˜ å°„\n- /etc/config æ ‡å‡†æŒ‚è½½","x":700,"y":-960,"width":230,"height":190},
		{"id":"architecture-principles","type":"text","text":"## æ¶æ„åŸåˆ™\n\n### ğŸ”§ æœ€å°å˜æ›´åŸåˆ™\n- æ–‡ä»¶åˆ†å¸ƒå³æ¨¡å—è§„åˆ’\n- ä¸¥æ ¼é”™è¯¯å¤„ç†\n- æ— é»˜è®¤å€¼ç­–ç•¥\n\n### ğŸ—ï¸ å®¹å™¨åŒ–è¿è¡Œ\n- Service Agent ä½¿ç”¨ --pid\n- è§‚æµ‹å®¿ä¸»æœºä¿¡æ¯\n- ç»Ÿä¸€è¿›ç¨‹å†…é€»è¾‘\n\n### ğŸ“Š ç›‘æ§ç»‘å®š\n- é›†ç¾¤éƒ¨ç½²ç›‘æ§\n- èŠ‚ç‚¹ IP è¿æ¥\n- ç¦ç”¨ localhost","x":1070,"y":-920,"width":250,"height":200},
		{"id":"nokube-core","type":"text","text":"# Nokube-rs Core\n\nåˆ†å¸ƒå¼æœåŠ¡ç®¡ç†å™¨\n- é›†ç¾¤åˆå§‹åŒ–\n- éƒ¨ç½²æ§åˆ¶\n- é…ç½®ç®¡ç†","x":-400,"y":-275,"width":200,"height":100},
		{"id":"cli-describe","type":"text","text":"## CLI: describe\n\nç”¨æ³•\n- `nokube describe <pod|deployment|daemonset|configmap|secret|service> <name> [-c <name>]`\n\nè¯´æ˜\n- ä» etcd æˆ–å†…ç½®æ¸²æŸ“è¾“å‡ºèµ„æºè¯¦æƒ…\n\nç¤ºä¾‹\n- `nokube describe pod gitops-controller-0 -c home-cluster`","x":1900,"y":-577,"width":360,"height":362},
		{"id":"cli-logs","type":"text","text":"## CLI: logs\n\nç”¨æ³•\n- `nokube logs <pod> [-c <name>] [--follow] [--tail N]`\n\nè¯´æ˜\n- ç»“åˆ etcd çŠ¶æ€/äº‹ä»¶ï¼›Running æ—¶å±•ç¤ºç¤ºä¾‹æ—¥å¿—ï¼›æ”¯æŒ `--follow`\n\nç¤ºä¾‹\n- `nokube logs my-pod -c home-cluster --tail 100`","x":1900,"y":-174,"width":360,"height":362},
		{"id":"cli-apply","type":"text","text":"## CLI: apply\n\nç”¨æ³•\n- `nokube apply -f <file> [--cluster <name>] [--dry-run]`\n- `cat manifest.yaml | nokube apply --cluster <name>`\n\nè¯´æ˜\n- æ”¯æŒå¤šæ–‡æ¡£ YAMLï¼›æœªæŒ‡å®š `-f` æ—¶ä» stdin è¯»å–\n- `--dry-run` ä»…è§£æ/æ‰“å°ï¼Œä¸å†™å…¥ etcd\n\nç¤ºä¾‹\n- `nokube apply -f gitops.yaml --cluster home-cluster`","x":2280,"y":-577,"width":360,"height":362},
		{"id":"cli-get","type":"text","text":"## CLI: get\n\nç”¨æ³•\n- `nokube get <pods|deployments|daemonsets|configmaps|secrets> [name] [-o table|json|yaml] [-c <name>] [--all-namespaces]`\n\nè¯´æ˜\n- é»˜è®¤è¾“å‡º `-o table`ï¼›`-c` ç­‰åŒ `--cluster`\n- services åˆ—è¡¨æš‚æœªå®ç°\n\nç¤ºä¾‹\n- `nokube get pods -c home-cluster -o table`","x":2280,"y":-174,"width":360,"height":362},
		{"id":"cli-agent-service","type":"text","text":"## CLI: agent-service\n\nç”¨æ³•\n- `nokube agent-service [--extra-params <BASE64(JSON)>]`\n\nè¯´æ˜\n- å¸¸é©»æœåŠ¡æ¨¡å¼è¿è¡Œ Agent","x":1450,"y":-168,"width":360,"height":362},
		{"id":"cli-agent-command","type":"text","text":"## CLI: agent-command\n\nç”¨æ³•\n- `nokube agent-command --extra-params <BASE64(JSON)>`\n\nè¯´æ˜\n- ä¸€æ¬¡æ€§å‘½ä»¤æ¨¡å¼ï¼›`extra-params` å¿…é¡»åŒ…å« `cluster_name`\n\nç¤ºä¾‹\n- `echo -n '{\"cluster_name\":\"home-cluster\"}' | base64`","x":1450,"y":-571,"width":360,"height":362},
		{"id":"n-distribution-flow","type":"text","text":"## åˆ†å‘æµç¨‹ (åŸºäº HTTP)\n1) æœ¬åœ°æ„å»º & æ‰“åŒ…\n2) ä¸Šä¼ åˆ° Head HTTP ç›®å½•\n3) å¯åŠ¨ http.server å®¹å™¨ (python:3.10-slim)\n4) èŠ‚ç‚¹ä¸‹è½½: `http://<head>:<port>/releases/nokube/...`\n   - cmdagent é€šè¿‡ curl ä¸‹è½½ `bin/`+`lib/` åæ‰§è¡Œ\n   - service agent åœ¨å®¹å™¨å†…ä½¿ç”¨ç›¸åŒæ¥æºè·å–ä¾èµ–\n5) ä¸å†é¢„åˆ†å‘åˆ°å„èŠ‚ç‚¹ (æ—  SSH é€ç‚¹æ‹·è´)\n","x":920,"y":-540,"width":440,"height":315},
		{"id":"807d8c1bd92464b0","type":"text","text":"## ğŸ“ OTLP æ—¥å¿—æ”¶é›† (å®ç°åŒæ­¥)\n\n**Endpoint (çº¦å®š):**\n- OTLP Logs: `http://{head}:{port}/v1/otlp/v1/logsï¼ˆport æ¥è‡ª ClusterConfig.monitoring.greptimedb.portï¼‰`\n\n**Headers:**\n- `X-Greptime-DB-Name=public`\n- `X-Greptime-Log-Table-Name=opentelemetry_logs`\n- `X-Greptime-Log-Extract-Keys=cluster_name,node_name,source,source_id,container,pod,root_actor,container_path`\n\n**Collector è¡Œä¸º:**\n- æ— å¤±è´¥é‡è¯•ï¼Œå¤±è´¥ä»… error log\n- å¤–å±‚è¶…æ—¶ä¿æŠ¤ï¼ˆå›ºå®š 5sï¼‰ï¼›å†…éƒ¨ `force_flush()` æ”¾å…¥ `spawn_blocking`\n- actor æ—¥å¿—è®¾ç½® `scope_name=container_path` (cluster/root_actor/pod/container)ï¼›å…¶ä»–æ¥æºä½¿ç”¨ `nokube-rs`\n\n**Greptime è¡¨:**\n- è¡¨: `opentelemetry_logs`\n- åˆ—: timestamp, severity_text, body, scope_name, log_attributes(JSON) ç­‰\n\n**Grafana æ—¥å¿—é¢æ¿:**\n- æ•°æ®æº: MySQL (greptimemysql)\n- å˜é‡: `container_path`ï¼ˆæ¥è‡ª `scope_name`ï¼‰\n- SQL ä½¿ç”¨ `${container_path:sqlstring}` å¯é€‰ç­›é€‰\n- æ—¥å¿—ä¸€è¡Œå±•ç¤ºï¼ˆéšè— Labels/Detailsï¼‰\n\n**Actor é¢æ¿è”åŠ¨:**\n- Containers è¡¨çš„ Container åˆ—è·³è½¬åˆ°æ—¥å¿—é¢æ¿ï¼Œé“¾æ¥æºå¸¦ `var-container_path=<full-path>`","x":1890,"y":2575,"width":700,"height":900},
		{"id":"63020bf5856229b9","type":"text","text":"## Exporter æ€»è§ˆ\n\nè·¯å¾„\n- `src/agent/general/exporter.rs`\n\nèŒè´£\n- é‡‡é›†ç³»ç»Ÿä¸å®¹å™¨æŒ‡æ ‡ï¼Œæ¨é€åˆ° GreptimeDB (Influx è¡Œåè®®)\n- æŒ‰é…ç½®è½®è¯¢ etcd è·å– `ClusterConfig`\n\næ¨é€ç›®æ ‡\n- `{greptime}/v1/influxdb/write`ï¼ˆç”± head èŠ‚ç‚¹ IP + `monitoring.greptimedb.port` ç»„è£…ï¼‰\n\nå‘¨æœŸ\n- metrics_interval é»˜è®¤ 30s\n- config_poll_interval é»˜è®¤ 10s\n\næ ‡ç­¾å¢å¼º\n- å®¹å™¨æŒ‡æ ‡è¿½åŠ  `container_path=cluster/root_actor/pod/container`ï¼Œä¸æ—¥å¿— `scope_name` å¯¹é½ï¼Œä¾¿äºä»ªè¡¨ç›˜è”åŠ¨\n\næ”¯æŒ\n- Cluster / Actor ä»ªè¡¨ç›˜","x":470,"y":2580,"width":560,"height":640},
		{"id":"exporter-system","type":"text","text":"## Exporter: ç³»ç»ŸæŒ‡æ ‡\n\né‡‡é›†\n- CPU ä½¿ç”¨ç‡: `/proc/stat`\n- CPU é€»è¾‘æ ¸: `/proc/cpuinfo`ï¼ˆæˆ– `/sys/devices/system/cpu/present` å…œåº•ï¼‰\n- å†…å­˜å ç”¨: `/proc/meminfo` (MemTotal/MemAvailable)\n- ç½‘ç»œæµé‡: `/proc/net/dev`ï¼ˆæ±‡æ€»é `lo` æ¥å£ï¼‰\n\næŒ‡æ ‡å\n- `nokube_cpu_usage`, `nokube_cpu_cores`\n- `nokube_memory_usage`, `nokube_memory_used_bytes`, `nokube_memory_total_bytes`\n- `nokube_network_rx_bytes`, `nokube_network_tx_bytes`\n\næ ‡ç­¾\n- `cluster_name`, `node`, `instance`ï¼ˆä¸‰è€…å–è‡ªèŠ‚ç‚¹/é›†ç¾¤ä¸Šä¸‹æ–‡ï¼‰","x":1030,"y":2580,"width":820,"height":460},
		{"id":"exporter-containers","type":"text","text":"## Exporter: å®¹å™¨æŒ‡æ ‡\n\nç›®æ ‡å®¹å™¨\n- åç§°ä»¥ `nokube-pod-` å¼€å¤´ï¼ˆ`docker ps --format {{.Names}}` è¿‡æ»¤ï¼‰\n\né‡‡é›†\n- `docker stats --no-stream --format \"{{.CPUPerc}}\\t{{.MemUsage}}\\t{{.MemPerc}}\"`\n\næŒ‡æ ‡å\n- `nokube_container_cpu`ï¼ˆå®¹å™¨ CPU%ï¼‰\n- `nokube_container_cpu_cores`ï¼ˆæ¢ç®—ä¸ºæ ¸: CPU% Ã— èŠ‚ç‚¹é€»è¾‘æ ¸æ•°ï¼‰\n- `nokube_container_mem_bytes`, `nokube_container_mem_percent`\n\næ ‡ç­¾\n- åŸºæœ¬: `cluster_name`, `node`, `instance`, `container`, `container_name`\n- Pod/Actor å½’å±: `pod`, `pod_name`, `parent_actor`(pod), `root_actor`, `top_actor`, `upper_actor`, `owner_type`, `canonical=1`\n- å½’ä¸€åŒ–: ç”±å®¹å™¨åæ¨æ–­ coreï¼Œ`upper_actor = <core>-<cluster>`","x":1030,"y":3080,"width":820,"height":580},
		{"id":"actor-comm","type":"text","text":"## ServiceAgent é—´é€šä¿¡\n\n### é¦–é€‰: etcd ä½œä¸ºæ§åˆ¶é¢æ€»çº¿\n- äº‹ä»¶/ä¿¡å·/å¿ƒè·³å‡èµ° etcd å‰ç¼€ `/nokube/{cluster}/actors/**`\n- ä¼˜ç‚¹: å»ä¸­å¿ƒã€å¹‚ç­‰ã€å¤©ç„¶å¤šèŠ‚ç‚¹\n\n### ä¸€è‡´æ€§çº¦æŸ\n- æ‰€æœ‰æ“ä½œéœ€å¹‚ç­‰ï¼Œå¹¶é€šè¿‡ etcd å¯é‡è¯•","x":1620,"y":1720,"width":560,"height":520},
		{"id":"actor-lifecycle","type":"text","text":"## Actor åç¨‹ç”Ÿå‘½å‘¨æœŸä¸æ²»ç†\n\n### è§’è‰²ä¸è·¯å¾„\n- ServiceAgent: `service/{node}/agent`\n- KubeController: `service/{node}/kubecontroller`\n- DeploymentActor: `service/{node}/deployment/{name}`\n- DaemonSetActor: `service/{node}/daemonset/{name}`\n\n> ç»Ÿä¸€ ActorPath ä¾¿äºè·¨èŠ‚ç‚¹ååŒ\n\n### å­˜æ´»ä¸çˆ¶å­å…³ç³»\n- å­˜æ´»é”®: `/nokube/{cluster}/actors/{actor_path}/alive` (etcd å¸¦ç§Ÿçº¦)\n  - `lease_ttl=15s`, keepalive `5s`\n  - å€¼åŒ…å«: `last_alive`, `node`, `version`\n- çˆ¶é”®: `/nokube/{cluster}/actors/{actor_path}/parent` â†’ çˆ¶ActorPath\n- å­é›†åˆ: `/nokube/{cluster}/actors/{actor_path}/children` â†’ å­ActorPathåˆ—è¡¨\n\n### å­éšçˆ¶ç­ (Supervisor)\n- å­åç¨‹ç›‘å¬çˆ¶ `alive`+`drain` ä¿¡å·ï¼›çˆ¶æ¶ˆå¤±æˆ–å‘å‡º `shutdown/drain` æ—¶å­åº”ä¼˜é›…é€€å‡º\n- è¶…æ—¶æœªé€€å‡ºâ†’ æœ¬åœ°å¼ºåˆ¶ `stop+rm` å®¹å™¨\n\n### ä¿¡å·é€šé“\n- `/nokube/{cluster}/actors/{actor_path}/signal`: `shutdown|drain|restart`\n- ç”±çˆ¶æˆ–æ§åˆ¶é¢å†™å…¥ï¼›å­æ¶ˆè´¹åå†™ `/ack`\n\n### æœ¬åœ°å®¹å™¨å‘½å\n- ç»Ÿä¸€ä¸º `nokube-pod-{deploymentName}`ï¼Œä¾¿äºè·¨æ¨¡å—å›æ”¶\n","x":1040,"y":1720,"width":560,"height":520},
		{"id":"orphan-gc","type":"text","text":"## Orphan Reaperï¼ˆå­¤å„¿å›æ”¶ï¼‰\n\nè§¦å‘\n- æ¯ 60s æ‰«ææœ¬æœº `nokube-pod-*` å®¹å™¨\n- è‹¥ä¸å­˜åœ¨å¯¹åº” etcd keyï¼ˆdeployments/podsï¼‰æˆ–çˆ¶Actor `alive` ç¼ºå¤±â†’ æ ‡è®°ä¸ºå­¤å„¿\n\nåŠ¨ä½œ\n- `docker stop && docker rm` å®¹å™¨\n- æ¸…ç† `/pods/{name}` ä¸ `/events/pod/{name}`\n\nåœºæ™¯\n- æ§åˆ¶é¢æˆ–çˆ¶Actorå´©æºƒåæ®‹ç•™\n- èŠ‚ç‚¹çŸ­æ—¶ç½‘ç»œåˆ†åŒºåçš„è‡ªæ„ˆ","x":420,"y":1720,"width":560,"height":520}
	],
	"edges":[
		{"id":"edge-1","fromNode":"nokube-core","fromSide":"left","toNode":"config-module","toSide":"right","label":"é…ç½®è¯»å–"},
		{"id":"edge-2","fromNode":"nokube-core","fromSide":"bottom","toNode":"agent-system","toSide":"top","label":"ä»£ç†ç®¡ç†"},
		{"id":"edge-3","fromNode":"nokube-core","fromSide":"right","toNode":"remote-control","toSide":"left","label":"è¿œç¨‹éƒ¨ç½²"},
		{"id":"edge-5","fromNode":"agent-system","fromSide":"bottom","toNode":"30cdd7fa9b891781","toSide":"left"},
		{"id":"edge-service-etcd","fromNode":"k8s-abstraction","fromSide":"left","toNode":"etcd-storage","toSide":"right","label":"è¯»å–é…ç½®ï¼Œéƒ¨ç½²actor"},
		{"id":"edge-cli-etcd","fromNode":"nokube-core","fromSide":"left","toNode":"etcd-storage","toSide":"right","label":"æŸ¥è¯¢PodçŠ¶æ€"},
		{"id":"edge-docker-ops","fromNode":"30cdd7fa9b891781","fromSide":"right","toNode":"docker-ops-module","toSide":"left","label":"å®¹å™¨ç®¡ç†"},
		{"id":"edge-docker-k8s","fromNode":"k8s-abstraction","fromSide":"right","toNode":"docker-ops-module","toSide":"bottom","label":"Podå®¹å™¨åŒ–"},
		{"id":"edge-docker-example","fromNode":"docker-ops-module","fromSide":"bottom","toNode":"docker-config-example","toSide":"bottom","label":"å®ç°ç¤ºä¾‹"},
		{"id":"edge-config-workspace","fromNode":"cluster-config","fromSide":"right","toNode":"docker-config-example","toSide":"bottom","label":"{workspace}é…ç½®æ¥æº"},
		{"id":"edge-config-etcd","fromNode":"cluster-config","fromSide":"top","toNode":"etcd-storage","toSide":"bottom","label":"é›†ç¾¤é…ç½®å­˜å‚¨"},
		{"id":"edge-config-docker","fromNode":"cluster-config","fromSide":"right","toNode":"docker-ops-module","toSide":"left","label":"workspaceè·¯å¾„"},
		{"id":"03a2ca3d55d61bc6","fromNode":"remote-control","fromSide":"bottom","toNode":"9213010bd51b4eba","toSide":"top"},
		{"id":"151253ad588032ae","fromNode":"config-module","fromSide":"bottom","toNode":"029a051cde4f5915","toSide":"top"},
		{"id":"c7f595250ae29636","fromNode":"nokube-config","fromSide":"right","toNode":"config-module","toSide":"left"}
	]
}
